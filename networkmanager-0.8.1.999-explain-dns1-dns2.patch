From: Andrey Borzenkov <arvidjaar@gmail.com>
Subject: [PATCH] explain how to add DNS servers on Mandriva

Update patch explain-dns1-dns2.patch for new version

Signed-off-by: Andrey Borzenkov <arvidjaar@gmail.com>

---
 src/dns-manager/nm-dns-manager.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/src/dns-manager/nm-dns-manager.c b/src/dns-manager/nm-dns-manager.c
index 7a6fbbc..1206ddf 100644
--- a/src/dns-manager/nm-dns-manager.c
+++ b/src/dns-manager/nm-dns-manager.c
@@ -358,7 +358,7 @@ write_resolv_conf (FILE *f, const char *domain,
 
 	str = g_string_new ("");
 
-	if (nameservers) {
+	if (nameservers && g_strv_length (nameservers)) {
 		int num = g_strv_length (nameservers);
 
 		for (i = 0; i < num; i++) {
@@ -374,6 +374,14 @@ write_resolv_conf (FILE *f, const char *domain,
 			g_string_append (str, nameservers[i]);
 			g_string_append_c (str, '\n');
 		}
+	} else {
+		nameservers_str = g_strdup_printf ("\n\n%s%s%s%s%s%s",
+			"# No nameservers found; try putting DNS servers into your\n",
+			"# ifcfg files in /etc/sysconfig/network-scripts like so:\n",
+			"#\n",
+			"# DNS1=xxx.xxx.xxx.xxx\n",
+			"# DNS2=xxx.xxx.xxx.xxx\n",
+			"# DOMAIN=lab.foo.com bar.foo.com\n");
 	}
 
 	nameservers_str = g_string_free (str, FALSE);
-- 
tg: (0616218..) cooker/explain-dns (depends on: mdv-next)
